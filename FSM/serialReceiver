module top_module(
    input clk,
    input in,
    input reset,    // Synchronous reset
    output done
); 
    parameter IDLE = 2'b00, WRONG = 2'b01, DATA= 2'b10, DONE = 2'b11;
    reg [1:0] state, next_state; 
    reg [31:0] count;
    always@(*) begin
        case(state)
            IDLE: begin
                if(in == 0) begin
                    next_state = DATA;
                end
                else begin
                    next_state = IDLE;
                end
            end
            WRONG: begin
                if(in == 1)begin
                    next_state = IDLE;
                end
                else next_state = WRONG;
            end
            DATA: begin
                if(in == 1 && count == 8) begin//进入DATA后，每个clk都在count++
                    next_state = DONE;//应该在下一拍(count==7)进入DONE
                end
                else if(in == 0 && count == 8) begin
                    next_state = WRONG;
                end
                else begin
                    next_state = DATA;
                end
            end
            DONE: begin
                if(in == 0) begin
                    next_state = DATA;
                end
                else begin
                    next_state = IDLE;
                end
            end
            default: next_state = IDLE;
        endcase
    end

    always@(posedge clk) begin
        if (reset) begin
            state <= IDLE;
            count <= 0;
        end 
        else begin
            state <= next_state;
            if(state == DATA) begin
                count <= count + 1'd1;
            end
            else begin
                count <= 0;
            end
        end
    end

    assign done = (state == DONE);
endmodule